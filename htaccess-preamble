RewriteEngine on
AuthUserFile /home/hunt/htpasswd/htpasswd
AuthName "Mystery Hunt"
AuthType Basic
Require valid-user

RewriteEngine On
RewriteBase /

#Redirect answer submissions and hq contact requests into django app
RewriteRule ^(?:/?teams/[^/]+)?(/?callin.*) /dynamic/solving/$1 [NS,NE,L]
RewriteRule ^(?:/?teams/[^/]+)?(/?contact_hq.*) /dynamic/solving/general/$1 [NS,NE,L]

#If we are already hitting via a team subdir, etc. skip all rewrites
RewriteCond %{REQUEST_URI} ^(/errors/|/teams|/server-status|/logout|/dynamic|/static|/admin)
RewriteRule .? - [L,NS]

#Add trailing slash here so mod_dir doesn't create 301 to team subdirs
#Yes this is a weird hack
RewriteCond %{REQUEST_URI} !(.*)/$
RewriteCond /var/www/spoilr/teams/%{LA-U:REMOTE_USER}%{REQUEST_URI} -d
RewriteRule ^(.*)$ $1/ [NS,L,R=301]

